# 231004
# django

# HTTP 특징

# 쿠키
서버가 사용자의 웹 브라우저에 전송하는 작은 데이터 조각
-> 클라이언트 측에서 저장되는 작은 데이터 파일이며, 사용자 인증, 추적, 상태 유지 등에 사용되는 데이터 저장 방식

# 쿠키 사용 원리
1. 브라우저(클라이언트)는 쿠키를 KEY-VALUE의 데이터 형식으로 저장
2. 이렇게 쿠키를 저장해 놓았다가, 동일한 서버에 재요청 시 저장된 쿠키를 함께 전송
3. 쿠키는 두 요청이 동일한 브라우저에서 들어왔는지 아닌지를 판단할 때 주로 사용됨
   1. 이를 이용해 사용자의 로그인 상태를 유지할 수 있음
   2. 상태가 없는 HTTP 프로토콜에서 상태 정보를 기억시켜주기 때문

이를 사용한 예시가 장바구니 기능!

로그인이 유지되는 것도 쿠키의 기능
따라서 웹 브라우저에서 쿠키를 삭제했을 때 모든 페이지에서 로그아웃이 되는 것이다...


# 쿠키 사용 목적
1. 세션 관리
   - 로그인, 아이디 자동완성, 공지 하루 안보기, 팝업 체크, 장바구니 등의 정보관리
2. 개인화
   - 사용자 선호, 테마 등의 설정
3. 트래킹
   - 사용자 행동을 기록 및 분석


# 세션
- 서버 측에서 생성되어 클라이언트와 서버 간의 상태(대표적으로 로그인!)를 유지
- 상태 정보를 저장하느 데이터 저장방식
-> 쿠키에 세션 데이터를 저장하여 매 요청시 마다 세션 데이터를 함께 보냄

# 세션 작동원리
1. 클라이언트가 로그인을 하면 서버가 세션 데이터를 생성후 저장 -> DB
2. 생성된 세션데이터에 인증할수 있는 세션id를 발급
3. 발급한 세션id를 클라이언트에 응답
4. 클라이언트는 응답받는 세션 id를 쿠키에 저장
5. 클라이언트가 다시 동일 서버에 접속하면 요청과 함께 쿠키를 서버에 전달
6. 쿠키는 요청 때마다 서버에 전송되므로 서버에서 세션id를 확인해 로그인 되어있다는 것을 알게함

# 쿠키와 세션의 목적 -> 서버와 클라이언트 간의 상태를 유지

# 쿠키 종류별 lifetime
1. session cookie
   - 현재 세션이 종료되면 삭제됨
   - 브라우저 종료와 함께 세션이 삭제됨
2. persistent cookies

# 세션 in Django

# Django Authentication System
## Authentication 인증
- 사용자가 자신이 누구인지 확인하는 것 (신원확인)

## Custom User model
Custom User model로 대체하기
django가 기본적으로 제공하는 User model은 내장된 auth 앱의 User클래스 사용

## User 클래스를 대체하는 이유?
- 우리는 지금까지 별도의 User 클래스 정의 없이 내장된 User 클래스를 사용했음
- 별도의 설정없이 사용할 수 있어 간편하지만, 개발자가 직접 수정할 수 없는 문제가 존재


## 대체하기
- AbstractUser를 상속받는 커스텀 User 클래스 작성

# 주의!
프로젝트 중간에 AUTH_USER_MODEL을 변경할 수 없음!
-> 이미 프로젝트가 진행되고 있을 경우 데이터베이스 초기화 후 진행

프로젝트를 시작하며 반드시 User 모델을 대체해야 한다.
- django는 새 프로젝트를 시작하는 경우 커스텀 모델 설정을 강력히 권장
- 나중에 설정할수 있기 때문
- 프로젝트의 모든 migrations 혹은 첫 migrate 전에 설정해야함!!!

# Login
- Session을 Create하는 과정

로그인/회원가입/회원정보 수정/비밀번호변경 이미 장고의 빌트인 form이 다 있다

# AuthenticationForm()
- 로그인 인증에 사용할 데이터를 입력받는 built-in form


# login(request, user)
# get_user()
-> 유효성 검사를 통과했을 경우 로그인 한 사용자 객체를 반환

# Logout
- Session을 Delete하는 과정

# logout(request)
- 현재 요청에 대한 Session Date를 DB에서 삭제
- 클라이언트의 쿠키에서도 Session ID 를 삭제

# Template with Authentication data

## Context Processors
- 템플릿이 렌더링 될대 호출 가능한 컨텍스트 데이터 목록
- 작성된 컨텍스트 데이터는 기본적으로 템플릿에서 사용가능한 변수로 포함됨
- ...


---

# 오후 수업 내용
# 여태까지 한 장고 정리

# 1일차

- python배움
- 패키지 다운로드 (pip)
  - pip : 파이썬 패키지 관리자
- 가상 환경
  - 여러가지 버전을 한 pc에서(하나의 환경) 관리하려고
  - ex) 내가 개발해야 할 프로그램1 = django 3.2 / 프로그램2 = django 4.2 일 때
- Django
  - Django 가 뭐예요?
    - 웹 개발 프레임워크
      - 프레임워크 vs 라이브러리 차이를 정확히 알고 설명할 줄 알아야 함!
    - Django 의 핵심요소 : MTV 디자인 패턴
      - 디자인 패턴이란?
        - 말하자면 '개발자 선배들의 정답지'
      - Django 의 MTV 디자인 패턴
        - MVC랑 똑같다!
        - Model, Template, View로 나누어서 관리하자!
        - 그림만 알면 Django는 끝이다!
    - 사용자 입력
      - 기존 : input 태그 도배
      - Django : Form 태그
        - Form, ModelForm
        - Form을 더 이쁘게, 잘 쓰는 법: widget
          - 위젯공부는 열심히 하지마... -> 장고를 백엔드로 본격적으로 사용하기 시작하면....
        - Form vs ModelForm
          - 사용자 입력을 models.py 에 정의한 필드'만' 쓰는 지 여부
            - ModelForm : 정의한 필드만 입력 받을거다
            - Form : 추가적인 내용을 입력 받을거다
              - 설정이 생각보다 귀찮음

- 구현이 목적이 되면 안된다!
  - 이해 + 스스로 구현 -> 많이 틀려보는 것!

---

- **오늘 내일 내용은 사용자 인증 관리를 구현하기 위해서 배움**

# 오늘 수업을 들은 후
- 쿠키와 세션의 개념
- 쿠키와 세션의 차이점
- Django 인증 시스템을 활용하는 방법(오늘~내일)

위의 것들은 확실히 가져가야 한다!


# Django Auth
- HTTP의 특성
  - HTTP?
    - 웹에서 쓰는 프로토콜
    - 프로토콜 : 통신 규약
      - 통신할 때 보내는 형식이나 내용을 약속해놓음
  - HTTP 의 특징
    - 비연결 지향 (Connectionless)
      - 서버가 클라이언트의 요청을 처리한 후에 연결을 끊어버리는 특성
      - 왜 비연결 지향으로 설계했을까?
        - 인터넷 상에서 불특정 다수에게 정보를 제공하는 것을 기반으로 설계
        - 불특정 다수가 모두 연결을 유지 == 서버 터짐!
        - 연결을 유지하는 것 보다는, 더 많은 새로운 연결을 할 수 있도록 설계해놓음
      - 단점은?
        - 매 요청 시마다 연결/해제 해야 함 -> 리소스가 추가적으로 발생
    - 무상태 (Stateless)
      - 서버가 클라이언트의 정보(상태)를 저장하고 있지 않음
      - 요청을 보낼 때, 클라이언트의 모든 정보를 같이 주어야 함
        - 장점 : 서버 부담 최소화
        - 단점 : 요청이 복잡해짐
  - 공통점 : 내가 누군지(내 데이터를 모두) 요청 시 마다 보내주어야 한다.
    - 이를 해결하기 위해, 쿠키와 세션을 사용함

- 쿠키
  - "클라이언트(브라우저)에 저장"하는 작은 데이터 조각
  - 최대 크기, 쿠키 최대 수량은 브라우저마다 다름
    - 크롬 : 4MB, 최대 약 180개
  - 요청을 보낼 때, 쿠키도 함께 전송
  - 장점: 
    - 서버에 부담이 적음 
  - 단점:
    - 요청을 보낼 때 항상 같이 보낸다 -> 보안에 비교적 취약

- 세션
  - 데이터 저장을 서버에 하고, 해당 데이터를 찾을 수 있는 key(세션ID)를 클라이언트가 소유
  - 요청 시 마다 세션ID를 전달 -> 서버는 해당 세션ID를 이용하여 사용자 데이터를 조회
  - 장점:
    - 비교적 보안이 좋음
  - 단점:
    - 서버에 부담이 가중됨
      - 세션ID를 통해 저장된 데이터를 서버가 열어보아야 한다.
      - 데이터를 서버에 저장 -> 리소스를 더 많이 먹는다.

장고는 기본적으로 세션방식 -> 세션 ID를 쿠키에 담아서...
현업에서는 쿠키와 세션 중 어느 것을 더 많이 쓸까???
-> JWT 라는 개념을 많이 사용한다... (Json Web Token)

- JWT (Json Web Token)
  - 반드시 알아야 할 사용자 인증 구현 방식
  - SSAFY 커리큘럼에는 왜 없을까??? -> 어려우니까...

